# Звіт до рефакторінгу проекту Chess game
## Виконав Дровольський Ярослав, К-29
## Запропоновані та реалізовані зміни:
-	Кращий поділ коду на файли (для кожного окремого класу – свої `.h` та `.cpp` файли)
-	Покращити `minimax` алгоритм: додати `alpha-beta pruning`. Також тепер можна визначати глибину дерева, яке будує алгоритм;
-	Прибрати дублювання коду при обробці подій та при відображенні вікна;
-	Змінити назви деяких методів на більш зрозумілі;
-	Прибрати використання `friend class` з класів `Army`, `Figure`, додавши відповідні getters і setters. Дані в класі `Field` тепер під модифікатором доступу `private` і доступ до них здійснюється через getters;
-	Реалізувати клас `MovesHistory`, який описує історію ходів протягом гри. Реалізувати для нього читання/запис з файлу. Також для цього класу зроблено unit tests;
-	Винести допоміжні функції, які не пов’язані з предметною областю (з грою в шахи) в окрему бібліотеку (`AuxLibrary`);
-	Відокремлення логіки гри від графічного інтерфейсу. Для цього створено клас `Ui`, який логічно описує і в цілому відповідає за графічний інтерфейс. Також за допомогою нього обробку подій вдалося зробити більш читабельною, коротшою та зрозумілішою;
-	Зробити перезапуск гри (restart) більш економним: тепер замість того, щоб присвоювати членам класу `ChessGame` нові змінні, члени класу відновлюють свій початковий стан за допомогою своїх методів (`restore()`, `clean()`);
-	Створено документацію за допомогою **Doxygen**;
-	Додано користувачу можливість змінювати розміри вікна;
-	Додано користувачу можливість зберігати та завантажувати гру;
-   `minimax` з `alpha-beta pruning` працює швидше за `minimax` з попередньої версії. Особливо це відчутно, коли ми збільшуємо максимальний рівень рекурсії.  
    Узагальнені результати можна представити у наступній таблиці:
    |max рівень рекурсії|previous minimax|current minimax|
    |:---------:|:---------:|:---------:|
    |2|До 0,01с|До 0,06с|
    |3|До 4с|До 1,3с|
    |4|Більше ніж 13с|Від 0,5с до 18с|

    ___

**Загальний обсяг коду** у новій версії проекту більший, ніж у попередній через те, що було додано новий функціонал. Збільшилася і кількість файлів, по яких код розподілений. Проте за рахунок цього збільшилася структурованість коду (тепер для кожного класу є свій `.h` та `.cpp` файли). Раніше клас `ChessGame` відповідав, окрім логіки гри, за графічний інтерфейс. Тепер він відповідає лише за логіку і за обробку подій. **Кількість коду** в цьому класі зменшилася *(з 1100 рядків до майже 800)* за рахунок винесення UI в окремий клас, а також за рахунок оптимізації обробки подій.  
З точки зору **основних принципів ООП** попередня версія проекту мала деякі недоліки: невиправдане використання `friend class` і відкриття полів у класі `Field` під модифікатором `public` *(порушення інкапсуляції)*. Зміни були направлені на усунення цих недоліків і в новій версії їх немає.  
Принципам **KISS** і **YAGNI** відповідають попередня та нова версії проекту: в них немає непотрібних функцій та надмірного узагальнювання.  
Принципу **DRY** не відповідала частина, пов'язана з відмалюванням UI та обробки подій, попередньої версії проекту: там було присутнє дублювання коду. До того ж, щоб, наприклад, перемістити кнопку потрібно було робити виправлення в двох місцях коду. Зміни усунули ці недоліки і тепер для переміщення кнопки достатньо відредагувати один рядок коду. Отже, нова версія проекту відповідає принципу DRY.  
Також завдяки змінам проект став більше відповідати **принципу можливості розвитку**: це і доданий клас `Ui`, за допомогою якого стає легше реалізувати зміни до UI, і логіка «поточного індексу» в списку ходів. Поточний індекс було додано для того, щоб в майбутньому можна було ітерувати по цьому списку, а це дасть можливість реалізувати режим «переглядача» гри (переходити між ходами вперед та назад).  
Попередня та нова версії проекту відповідають **принципу абстракції**, оскільки кожен об’єкт представлений мінімальним набором полів та методів, яких достатньо для реалізації гри в шахи.  
Після внесених змін проект став більше відповідати **принципу розподілу функціональності** (бо в ньому відокремлено UI від логіки). Проте, через специфіку предметної області, «головним» є клас `ChessGame`, який реалізує основну логіку, а задача інших класів полягає у тому, щоб надавати класу `ChessGame` допоміжні функції.  
**Принципу повторного використання** відповідає, зокрема, реалізована бібліотека `AuxLibrary`, яка складається з допоміжних функцій, які не пов'язані з грою в шахи. Також допоміжні класи і структури (`Point`, `Field`, `Figure` тощо) можна використовувати для якогось іншого проекту, який в основі має шахи.  
Після змін проект став більше відповідати **принципу можливості підтримки**: код став набагато зрозумілішим, в тому числі і за рахунок доданої документації, тому в ньому стало простіше щось виправити, додати, скоригувати.  
Нова версія проекту стала більше відповідати **SOLID принципам** (окрім, можливо, dependency inversion principle).  
Щодо **coupling/cohesion**: до змін код був схожий на так званий *God object* (високі coupling та cohesion) – один об’єкт (екземпляр класу `ChessGame`) виконував майже всю роботу. Після змін проект став більше відповідати вимозі *«high cohesion & low coupling»* - розділення на файли дозволило згрупувати найбільш пов’язаний код і водночас розділити непов’язаний код.  
**Закон Деметри** (Law of Demeter) порушується як в початковому проекті, так і у виправленій версії: в коді присутні конструкції типу `a.b.method1().method2()` – наприклад у методі `ChessGame::eraseIncorrectMoves()`.  
Попередня та нова версії проекту відповідають **принципу найменшого здивування** (Principle of least astonishment): в інтерфейсі та у функціоналі програми немає чогось двозначного чи незрозумілого.
